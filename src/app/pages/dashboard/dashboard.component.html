<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="arrow-down"
      pullingText="Arrastra para actualizar"
      refreshingSpinner="circles"
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="dashboard-section">
    <div *ngIf="isLoadingStats" class="dashboard-loading">
      <ion-spinner></ion-spinner>
      <p>Cargando estad√≠sticas...</p>
    </div>

    <div *ngIf="!isLoadingStats && dashboardStats" class="dashboard-content">
      <!-- Resumen de hoy -->
      <div class="summary-section">
        <div class="summary-header">
          <div class="summary-icon">üéØ</div>
          <div class="summary-title-content">
            <h2 class="summary-title">Resumen de hoy</h2>
            <p class="summary-subtitle">Hoy, has realizado:</p>
          </div>
        </div>

        <div class="stats-cards">
          <ion-card class="stat-card sales-card">
            <ion-card-content>
              <div class="stat-icon-wrapper">
                <ion-icon name="cash" class="stat-icon-white"></ion-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-label">VENTAS DEL D√çA</h3>
                <p class="stat-value">{{ formatCurrency(dashboardStats.todaySales.total) }}</p>
                <p class="stat-subtitle">{{ dashboardStats.todaySales.count }} ventas</p>
              </div>
            </ion-card-content>
          </ion-card>

          <ion-card class="stat-card average-card">
            <ion-card-content>
              <div class="stat-icon-wrapper">
                <ion-icon name="receipt" class="stat-icon-white"></ion-icon>
              </div>
              <div class="stat-info">
                <h3 class="stat-label">TICKET PROMEDIO</h3>
                <p class="stat-value">{{ formatCurrency(dashboardStats.todaySales.average) }}</p>
                <p class="stat-subtitle">Por venta</p>
              </div>
            </ion-card-content>
          </ion-card>
        </div>
      </div>

      <!-- Ventas de la semana -->
      <ion-card class="chart-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="bar-chart"></ion-icon>
            Ventas de la semana
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <!-- Selector de per√≠odo -->
          <div class="period-selector">
            <button 
              class="period-btn" 
              [class.active]="selectedPeriod === 'today'"
              (click)="selectPeriod('today')">
              Hoy
            </button>
            <button 
              class="period-btn" 
              [class.active]="selectedPeriod === '7days'"
              (click)="selectPeriod('7days')">
              √öltimos 7 d√≠as
            </button>
            <button 
              class="period-btn" 
              [class.active]="selectedPeriod === '30days'"
              (click)="selectPeriod('30days')">
              √öltimos 30 d√≠as
            </button>
          </div>

          <!-- Gr√°fico -->
          <div class="chart-container" *ngIf="chartOptions.series && chartOptions.chart">
            <apx-chart
              #chart
              [series]="chartOptions.series!"
              [chart]="chartOptions.chart!"
              [xaxis]="chartOptions.xaxis!"
              [yaxis]="chartOptions.yaxis!"
              [dataLabels]="chartOptions.dataLabels!"
              [tooltip]="chartOptions.tooltip!"
              [legend]="chartOptions.legend!"
              [stroke]="chartOptions.stroke!"
              [plotOptions]="chartOptions.plotOptions!"
              [colors]="chartOptions.colors!">
            </apx-chart>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Top productos y stock bajo -->
      <div class="dashboard-grid">
        <!-- Top productos m√°s vendidos -->
        <ion-card class="top-products-card">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="star"></ion-icon>
              Top productos
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div *ngIf="topProductsWithImages.length === 0" class="empty-state-small">
              <p>No hay productos vendidos a√∫n</p>
            </div>
            <div *ngIf="topProductsWithImages.length > 0" class="top-products-list">
              <div *ngFor="let product of topProductsWithImages; let i = index" class="top-product-item">
                <span class="product-rank">#{{ i + 1 }}</span>
                <img [src]="product.image" [alt]="product.productName" class="product-thumbnail" *ngIf="product.image">
                <div class="product-info">
                  <span class="product-name-small">{{ product.productName }}</span>
                  <span class="product-sold">{{ product.totalSold }} vendidos</span>
                </div>
                <span class="product-price">{{ formatCurrency(product.priceSale) }}</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Productos con stock bajo -->
        <ion-card class="low-stock-card">
          <ion-card-header>
            <ion-card-title class="low-stock-title">
              <ion-icon name="warning"></ion-icon>
              Stock bajo
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div *ngIf="lowStockProductsWithImages.length === 0" class="empty-state-small">
              <p>‚úÖ Todo el stock est√° bien</p>
            </div>
            <div *ngIf="lowStockProductsWithImages.length > 0" class="low-stock-list">
              <div *ngFor="let product of lowStockProductsWithImages" class="low-stock-item">
                <img [src]="product.image" [alt]="product.name" class="product-thumbnail" *ngIf="product.image">
                <div class="stock-info">
                  <span class="product-name-small">{{ product.name }}</span>
                  <span class="stock-quantity">Stock: {{ product.quantity }}</span>
                </div>
                <ion-button size="small" fill="outline" class="view-button" (click)="goToProducts()">
                  VER
                  <ion-icon slot="end" name="arrow-forward"></ion-icon>
                </ion-button>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </div>
  </div>
</ion-content>
