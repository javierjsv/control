<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Dashboard</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content
      pullingIcon="arrow-down"
      pullingText="Arrastra para actualizar"
      refreshingSpinner="circles"
      refreshingText="Actualizando...">
    </ion-refresher-content>
  </ion-refresher>

  <div class="dashboard-section">
    <h2 class="dashboard-title">ðŸ“Š Resumen del dÃ­a</h2>
    
    <div *ngIf="isLoadingStats" class="dashboard-loading">
      <ion-spinner></ion-spinner>
      <p>Cargando estadÃ­sticas...</p>
    </div>

    <div *ngIf="!isLoadingStats && dashboardStats" class="dashboard-content">
      <!-- Cards de estadÃ­sticas principales -->
      <div class="stats-cards">
        <ion-card class="stat-card sales-card">
          <ion-card-content>
            <div class="stat-icon">ðŸ’°</div>
            <div class="stat-info">
              <h3 class="stat-label">Ventas del dÃ­a</h3>
              <p class="stat-value">{{ formatCurrency(dashboardStats.todaySales.total) }}</p>
              <p class="stat-subtitle">{{ dashboardStats.todaySales.count }} ventas</p>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card average-card">
          <ion-card-content>
            <div class="stat-icon">ðŸ“ˆ</div>
            <div class="stat-info">
              <h3 class="stat-label">Promedio</h3>
              <p class="stat-value">{{ formatCurrency(dashboardStats.todaySales.average) }}</p>
              <p class="stat-subtitle">Por venta</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- GrÃ¡fico de ventas Ãºltimos 7 dÃ­as -->
      <ion-card class="chart-card">
        <ion-card-header>
          <ion-card-title>
            <ion-icon name="bar-chart"></ion-icon>
            Ventas Ãºltimos 7 dÃ­as
          </ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="chart-container">
            <div class="chart-bars">
              <div *ngFor="let day of dashboardStats.last7DaysSales" class="chart-bar-wrapper">
                <div class="chart-bar" [style.height.%]="getBarHeight(day.total, dashboardStats.last7DaysSales)">
                  <span class="bar-value">{{ formatCurrency(day.total) }}</span>
                </div>
                <span class="bar-label">{{ day.date }}</span>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>

      <!-- Top productos y stock bajo -->
      <div class="dashboard-grid">
        <!-- Top productos mÃ¡s vendidos -->
        <ion-card class="top-products-card">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="trending-up"></ion-icon>
              Top productos
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div *ngIf="dashboardStats.topProducts.length === 0" class="empty-state-small">
              <p>No hay productos vendidos aÃºn</p>
            </div>
            <div *ngIf="dashboardStats.topProducts.length > 0" class="top-products-list">
              <div *ngFor="let product of dashboardStats.topProducts; let i = index" class="top-product-item">
                <span class="product-rank">#{{ i + 1 }}</span>
                <div class="product-info">
                  <span class="product-name-small">{{ product.productName }}</span>
                  <span class="product-sold">{{ product.totalSold }} vendidos</span>
                </div>
                <span class="product-revenue">{{ formatCurrency(product.totalRevenue) }}</span>
              </div>
            </div>
          </ion-card-content>
        </ion-card>

        <!-- Productos con stock bajo -->
        <ion-card class="low-stock-card">
          <ion-card-header>
            <ion-card-title>
              <ion-icon name="alert-circle"></ion-icon>
              Stock bajo
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <div *ngIf="dashboardStats.lowStockProducts.length === 0" class="empty-state-small">
              <p>âœ… Todo el stock estÃ¡ bien</p>
            </div>
            <div *ngIf="dashboardStats.lowStockProducts.length > 0" class="low-stock-list">
              <div *ngFor="let product of dashboardStats.lowStockProducts" class="low-stock-item">
                <div class="stock-info">
                  <span class="product-name-small">{{ product.name }}</span>
                  <span class="stock-quantity">Stock: {{ product.quantity }}</span>
                </div>
                <ion-button size="small" fill="outline" (click)="goToProducts()">
                  Ver
                  <ion-icon slot="end" name="arrow-forward"></ion-icon>
                </ion-button>
              </div>
            </div>
          </ion-card-content>
        </ion-card>
      </div>

      <!-- Accesos rÃ¡pidos -->
      <ion-card class="quick-actions-card">
        <ion-card-header>
          <ion-card-title>Accesos rÃ¡pidos</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div class="quick-actions">
            <ion-button expand="block" (click)="goToSales()" class="action-button">
              <ion-icon slot="start" name="cash"></ion-icon>
              Ver todas las ventas
            </ion-button>
            <ion-button expand="block" (click)="goToFullSale()" class="action-button">
              <ion-icon slot="start" name="add-circle"></ion-icon>
              Nueva venta
            </ion-button>
          </div>
        </ion-card-content>
      </ion-card>
    </div>
  </div>
</ion-content>
